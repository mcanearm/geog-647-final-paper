---
title: 'Back to the Future: Insights into Public Transit Service through the Lens of Historical Streetcar Routes'
author:
  - name: Matt McAnear
    email: mmcanear@nevada.unr.edu
    affiliation: University of Nevada, Reno
abstract: >
  At its height, Milwaukee's streetcar system was an integral part of the transportation system. Like 
  most American cities, the streetcar was dismanlted and replaced with buses after WWII.
  This paper examines the question of who would be served by the Milwaukee trolley
  system were it not demolished. As of today, modern bus lines run along and beyond the historical
  lines, exceeding service levels in both population and geographic extent. Historical routes in 
  Milwaukee do not offer any significantly better or worse level of service. Just as importantly,
  busy historical trolley routes remain the busiest routes of today. While reimplemntation of the 1917 
  trolley network as a light rail system would potentially provide some benefits to the city of Milwaukee,
  these benefits would be isolated to light rail as a mode of transport, and not due to the 
  particular effectiveness of the network.
bibliography: references.bib
csl: acm-sig-proceedings.csl
output: rticles::acm_article
---


```{r setup, echo=FALSE, message=FALSE}
suppressPackageStartupMessages(library(sf))
suppressPackageStartupMessages(library(sp))
suppressPackageStartupMessages(library(ggplot2))
suppressPackageStartupMessages(library(data.table))
suppressPackageStartupMessages(library(rmarkdown))
suppressPackageStartupMessages(library(knitr))
knitr::opts_chunk$set(echo = FALSE, cache = TRUE, dev="png")
options(scipen=100)
```



```{r raw_data_in, echo=FALSE, message=FALSE, warning=FALSE}
void <- capture.output(allBlocks <- st_read('../data/paper-data/milwaukee-csa-blocks/milwaukee-blocks.shp'))
allBlocks$area <- st_area(allBlocks)

# we are removing the largest five blocks, since they are 100% on water with no population and 
# make the maps weird
rm_block_id <- allBlocks[order(allBlocks$area, decreasing = TRUE), ][1:5, ]$gid 
milwaukee_blocks <- allBlocks[-which(allBlocks$gid %in% rm_block_id), ]

# get routes
void <- capture.output(trolleyRoutes <- st_read('../data/paper-data/trolley-routes/1917/routes.shp'))
void <- capture.output(busRoutes <- st_read('../data/paper-data/bus-routes/bus-routes.shp'))
busRoutes$transport <- 'Bus'
trolleyRoutes$transport <- 'Trolley'
trolleyRoutes$len <- st_length(trolleyRoutes)
busRoutes$len <- st_length(busRoutes)

# find intersection of the routes and census blocks
trolley_blocks <- st_intersection(allBlocks, st_buffer(trolleyRoutes, 1000))
bus_blocks <- st_intersection(allBlocks, st_buffer(busRoutes, 1000))

# now not route by route
uniqueTrolleyBlocks <- st_intersection(allBlocks, st_union(st_buffer(trolleyRoutes, 1000)))
uniqueBusBlocks <- st_intersection(allBlocks, st_union(st_buffer(busRoutes, 1000)))
uniqueTrolleyBlocks$transport <- 'Trolley'
uniqueTrolleyBlocks$lineCount <- nrow(trolleyRoutes)
uniqueBusBlocks$transport <- 'Bus'
uniqueBusBlocks$lineCount <- nrow(busRoutes)

# function for adjusting population
adjustPopulation <- function(intersectionDF) {
  area_pct_vect <- as.numeric(st_area(intersectionDF)/intersectionDF$area)
  adj_pop <- as.integer(round(area_pct_vect * intersectionDF$pop10, 0))
  adj_housing <- as.integer(round(area_pct_vect * intersectionDF$housing10, 0))
  
  # return the original data frame wiht the adjusted values appended
  intersectionDF$area_pct <- area_pct_vect
  intersectionDF$pop10_adj <- adj_pop
  intersectionDF$housing10_adj <- adj_housing
  intersectionDF
}

dataSets <- list(trolley_blocks, bus_blocks, uniqueTrolleyBlocks, uniqueBusBlocks)
names(dataSets) <- c('trolley_routes', 'bus_routes', 'trolley_total', 'bus_total')
adjustedData <- lapply(dataSets, adjustPopulation)
```


# Introduction

The privately-owned Milwaukee Electric Railway & Light Company (TMER\&L Co.) purchased several smaller
railway companies in Milwaukee to become the first city-wide trolley system[@noauthor_milwaukee_nodate-1]. 
The history of Milwaukee's streetcar largely mirrors
the history of other streetcar systems. Milwaukee's streetcar history differed from comparable cities
due to population distribution, compact city development, and the inability of lower class
citizens to afford fares. For these reasons, the streetcar network focused service 
on the downtown area and less on outlying areas[@simon_city-building_1996].

In spite of its lower than average utilization at the turn of the century, it is important to recognize
that the Milwaukee streetcar system remained an essential part of the transportation network, especially
later into the 20th century. According to a 1928 report, streetcars comprised 5% of vehicles entering the city but over 47% of passengers; by comparison, automobiles comprised 77% of all vehicles, 
but only 45% of passengers[@moore_state_2014].

This level of ridership would not be sustained, however. In March of 1958, the streetcar system was
scrapped, finally succumbing to a combination of "(1) consumer preference, ...; (2) the capitalistic 
ambitions of pro-roads industrialists; (3) federal economic incentives, ...; 
and (4) simple (myopic) planning preference[,]" in addition to legal issues and constraints specific 
to Milwaukee[@moore_state_2014].

The national dismantling of streetcar systems is associated (and rightly so) with the emergence
of the private automobile as the principle form of transit. But do the routes that once served so many
people on streetcars remain important into the future? Is it the case that all public transit was dismantled,
or rather, that old trolley lines were replaced with buses, retaining the level of service? To answer these
queestions, we will overlay the historical trolley routes of Milwaukee over census blocks
from the 2010 census to estimate the total population served by current bus routes and historical 
trolleys.

# Methodology

The trolley system in Milwaukee was not static the system generally expanded since its founding
until the early 20th century declining thereafter. To estimate our population served, 
we will use the system in 1917; this is when the system was at its maximum length. 

It was important to compare historical transit routes against a modern analogue, and for this
we used the bus routes published by the city of Milwaukee in their open data portal[@noauthor_mclio_nodate].
While the new bus routes were easy to find from a well-maintained public source, there is no such 
central repository for historical trolley routes. Digitization of these streetcar routes is 
often left to the individual researcher through manual mapping from historical images. 
In the case of Milwaukee, the original KML file used for this project was manully created by 
re-tracing routes in Google Maps for a blog post about the new Milwaukee trolley 
"The Hop[@joe_powell_historical_2015];" their source was a personal website[@bill_vandervoort_chicago_nodate].
Maps in both locations visually align well with a newspaper publication about the history of 
the streetcar[@mikkelson_look_nodate]. It would be ideal to have a scholarly source for the maps,
but the data in question is difficult to come by. Still, the alignment between two
separate sources from different authors validates that the maps provided in the KML are of a 
high enough quality to use with caution.

One large assumption of the current analysis is that a person can conceivably
get on a bus or could have gotten on a trolley at any point along its route. This
doesn't matter as much for trolleys, but for buses this can lead to an especially
large over-estimate of population, particular in the case of the northbound
bus route.

Trolley routes (in KML format) and 2010 census block population estimates (as a shapefile) for 
the nation were imported from KML loaded into PostGreSQL. Once in PostgreSQL, routes
were load into QGis for easier manipulation. A shapefile of bus routes in Milwaukee was loaded into 
QGis and then put into PostgreSQL as well. Each file was converted to a UTM 
projection in QGis and finally output to standard ESRI shapefiles to use in the 
final analysis. 

```{r populationService, fig.height = 4, fig.cap = "Current bus routes and 1917 trolley routes of Milwaukee laid over 2010 census blocks. All census blocks in the Milwaukee CSA are considered, but this set is truncated for legibility.", results='asis', fig.pos='here'}

trolleyDT <- as.data.table(adjustedData$trolley_routes)
busDT <- as.data.table(adjustedData$bus_routes)
setnames(busDT, 'gid.1', 'route_id')
transportRouteDT <- rbindlist(list(busDT, trolleyDT), use.names = TRUE, fill = TRUE)
routeDT <- transportRouteDT[, .(
  'Pop Served' = sum(pop10_adj),
  'Housing Units Served' = sum(housing10_adj)
), by = c('transport', 'route_id')]


# clean up into a mergable format (there has to be a better way to do this)
busRouteDT <- as.data.table(busRoutes[, c('gid', 'geometry', 'transport')])
trolleyRouteDT <- as.data.table(trolleyRoutes[, c('route_id', 'geometry', 'transport')])
setnames(busRouteDT, colnames(trolleyRouteDT))
trolleyRouteDT$geometry <- st_cast(trolleyRouteDT$geometry, 'MULTILINESTRING')

routeGeoms <- rbindlist(list(trolleyRouteDT, busRouteDT))
routePopDT <- merge(routeDT, as.data.table(routeGeoms), 
                    by.x = c('route_id', 'transport'), by.y = c('route_id', 'transport'), all.x = TRUE)

routePopDT <- st_as_sf(routePopDT)
routePopDT$category <- cut(routePopDT$`Pop Served`, breaks = c(0, 50000, 100000, Inf))
bbox <- st_bbox(busRouteDT$geometry)
ggplot(data = routePopDT, aes(color = category)) +
  # scale_color_brewer(palette = 'Dark2') +
  # geom_sf(data = milwaukee_blocks, lwd = 0.05, alpha=0.5, fill='White', 
  #         color = 'Black', inherit.aes = FALSE) +
  theme_bw() +
    facet_wrap(~ transport) +
  theme(legend.position = 'top', panel.grid.major = element_blank(), axis.text = element_blank(), axis.ticks = element_blank()) +
  guides(color = guide_legend(title = 'Route Type')) +
  scale_x_continuous(limits = c(bbox['xmin'], bbox['xmax'])) +
  scale_y_continuous(limits = c(bbox['ymin'], bbox['ymax'])) +
  geom_sf() 

```


For each route system, we create a buffer of 1km around each transit route. With
these buffers we find the intersection of the buffer polygons and census blocks.
For any partial overlap, we calculate the percentage of overlap using a ratio
of the polygon intersection and the original census block area. Assuming
a uniform population within each census block, we multiply the 
population and number of households by this ratio to find an estimated population
served by a transit route.

```{r bus_trolley_plot, echo = FALSE, fig.height=4, fig.cap="Map of the 4 counties comprising the Milwaukee MSA. The majority of the MSA by land area is not served by public transit into Milwaukee proper. The 1917 trolley network serves Milwaukee proper, while the buses serve only the outer city and inner suburbs.", fig.pos='here', message=FALSE}
uniqueBusBlocks <- adjustedData$bus_total
uniqueTrolleyBlocks <- adjustedData$trolley_total
both <- intersect(uniqueBusBlocks$gid, uniqueTrolleyBlocks$gid)
onlyBus <- setdiff(uniqueBusBlocks$gid, uniqueTrolleyBlocks$gid)
onlyTrolley <- setdiff(uniqueTrolleyBlocks$gid, uniqueBusBlocks$gid)

# assign groupings according to what transport is accessible
milwaukee_blocks$transport <- 'None'
milwaukee_blocks$transport[which(milwaukee_blocks$gid %in% onlyBus)] <- 'Bus Only'
milwaukee_blocks$transport[which(milwaukee_blocks$gid %in% onlyTrolley)] <- 'Trolley'
milwaukee_blocks$transport[which(milwaukee_blocks$gid %in% both)] <- 'Trolley + Bus'


bothBlocks <- uniqueTrolleyBlocks[which(uniqueTrolleyBlocks$gid %in% both), ]
bothBlocks$transport <- 'Both'
busOnlyBlocks <- uniqueBusBlocks[which(uniqueBusBlocks$gid %in% onlyBus), ]
busOnlyBlocks$transport <- 'Bus Only'

fullSet <- rbind(bothBlocks, busOnlyBlocks)

p <- ggplot(data = milwaukee_blocks, aes(fill = transport, color=transport)) +  
  geom_sf(lwd=0.01, color='black') +
  theme_bw() +
  theme(legend.position = 'top', axis.text = element_blank(), axis.ticks = element_blank(),
        panel.grid.major = element_blank(), text = element_text(size = 12)) +
  guides(fill = guide_legend(title = 'Transport Type')) +
  scale_fill_brewer(palette = 'Dark2')
p

```


This analysis is performed twice. First, we do this on each individual trolley
route and bus route. This allows us to estimate the total population served by 
each route. However, this creates an issue of multiple counting - a particular
block can be (and often is) served by multiple bus and trolley lines. These estimates
are useful for comparing line by line, but not for aggregation.

To examine fully aggregated results, we combine the route geometries into a single
geom and take the union of each route. Once this is complete, we repeat the 
route by route analysis for the aggregated polygon. This yields an estimate 
of population served without the problem of multi counting.

# Results

Simple overlays of the historical streetcar routes and modern bus routes show 
a strong overlap between the systems. In fact, there are no census blocks in Milwaukee
that are covered by a historical trolley route but not by a modern bus route.
Buses completely supplanted the streetcar in Milwaukee, and newer bus routes extend well beyond
the historical trolley network.

This finding is expected, but interesting nonetheless. In terms of the physical routes involved, the 21st 
century bus lines should be offering the same mobility to residents that the older lines did. This does not
confirm that levels of service were identical in the years following the dismantling of the trolley system,
since our particular snapshots of the data are separated by around 100 years. Further, without data
on headways and transit times, we cannot say how well these lines actually serve the population
that lives within a community. 


```{r total_transport_counts, fig.pos='here'}
trolleyRouteLength <- sum(st_length(trolleyRoutes))
busRouteLength <- sum(st_length(busRoutes))
routeLenDT <- data.table(
    'transport' = c('Trolley', 'Bus'),
    'len' = as.numeric(c(trolleyRouteLength, busRouteLength)/1000)
)

allTransportBlocks <- as.data.table(rbind(adjustedData$trolley_total, adjustedData$bus_total))
transportSummary <- allTransportBlocks[, .(
  # 'Block Count' = .N,
  'Population' = sum(pop10_adj),
  'Pop/Line' = sprintf('%i', round(sum(pop10_adj)/max(lineCount), 0))
), by = c('transport')]
transportSummary <- merge(transportSummary, routeLenDT, by = c('transport'))
transportSummary[, pop_p_km := Population/len]
# routeLengths <- rbindlist(list(trolleyDT, busDT), use.names = TRUE, fill = TRUE)
# routeLengths[, max(len), by = c('route_id', 'transport')]
kable(transportSummary[, .(transport, Population, `Pop/Line`, len, pop_p_km)], format = 'latex', caption = 'Total population served by trolley network of 1917 and modern bus routes. Population per line and per kilometer is rounded to nearest integer.', digits = 0, col.names = c('Mode', 'Pop', 'Pop/Line', 'Route-Km', 'Pop/Km'))
```

Examining the lines in more detail adds color to the interplay between new routes and old. At the highest level buses serve `r sprintf('%0.0f', ((transportSummary[transport == 'Bus', Population] - transportSummary[transport == 'Trolley', Population])/transportSummary[transport == 'Bus', Population])*100)` 
percent more people than trolleys, but with `r sprintf('%0.0f', ((transportSummary[transport == 'Bus', len] - transportSummary[transport == 'Trolley', len])/transportSummary[transport == 'Bus', len])*100)` 
percent more route-kilometers. This indicates that more people are served by bus routes than trolley routes,
but the new routes that have been added serve a small number of additional people relative to the additional
length of route required. Since the cost of each additional mile is relatively fixed (to a point), each
person in further flung areas is additonally less profitable for the transit authority.

```{r, echo = FALSE, fig.cap = 'Kernel density estimation and two sample t-test comparing population density of census blocks served by a trolley line and those served exclusively by a bus line.', message=FALSE, warning=FALSE, fig.pos='here'}
separateBlockTransportData <- allTransportBlocks[transport == 'Trolley' | (transport == 'Bus' & gid %in% onlyBus)]
separateBlockTransportData[, ppl_square_km := as.numeric(pop10/(area/1000^2))]

busTrolleyTest <- t.test(
    separateBlockTransportData[transport == 'Trolley', ppl_square_km], 
    separateBlockTransportData[transport == 'Bus', ppl_square_km]
)

reportResult <- c(busTrolleyTest$estimate, busTrolleyTest$statistic, busTrolleyTest$p.value)
names(reportResult) <- c('Trolley Mean', 'Bus Mean', 't-statistic', 'p-value')

ggplot(data = separateBlockTransportData, aes(x = ppl_square_km, fill = transport)) +
    geom_density(alpha = 0.75) +
    scale_x_log10() +
    theme_bw() +
    scale_fill_brewer(palette = 'Dark2')  +
    annotate('text', x = 5, y = 1.0, 
             label = paste0(sprintf('%s: %0.02f', names(reportResult), reportResult), collapse='\n'), 
             hjust=0) +
    theme(axis.title.y = element_blank()) +
    xlab(bquote('People/km'^2)) +
    guides(fill = guide_legend(title = 'Transport Mode'))

```

To test this, we will compare our trolley-served blocks against those census blocks served only by bus 
routes. Because the census create blocks to have roughly equal population but with varying size, 
we divide the population of a block by the area of the block to get the population density. 
The differences between these two groups are highly significant. Census blocks with access to a trolley route,
on average, have a density of `r sprintf('%0.0f', reportResult['Trolley Mean'])` people per kilometer; by
comparison, bus routes have an average density of 
`r sprintf('%0.0f', reportResult['Bus Mean'])` (`r sprintf('%0.0f', ((reportResult['Trolley Mean'] - reportResult['Bus Mean'])/reportResult['Trolley Mean'])*100)` percent higher).

<!-- Across the city, transit lines are not generally very concentrated, though the population served is  -->
<!-- more concentrated among trolley routes than bus routes. In this case -->

```{r lorenz_distributions, fig.cap="Lorenz Curves by travel mode. This methodology double counts population that is served by multiple lines, but does so equally across modes. Trolley lines are slightly more concentrated.", include = FALSE}

plotData <- as.data.table(routePopDT)

dissimilarityIndex <- function(x) {
  pct_y <- x/sum(x)
  pct_x <- 1/length(x)
  0.5 * sum(abs(pct_y - pct_x))
}

lorenzData <- plotData[
  ][order(`Pop Served`), .SD, by = 'transport'
  ][, .(
    'id_pct' = 1:.N,
    'pop_pct' = cumsum(`Pop Served`)/sum(`Pop Served`),
    'total_count' = .N
  ), by = c('transport')
  ][, .(transport, 'id_pct' = id_pct/total_count, pop_pct)
]

indices <- plotData[, dissimilarityIndex(`Pop Served`), by = 'transport']
indexText <- sprintf(
  'Dissimilarity Indices:\nBus - %0.03f\nTrolley - %0.03f', 
  indices[transport == 'Bus', V1], 
  indices[transport == 'Trolley', V1]
)
ggplot(data = lorenzData, aes(x=id_pct, y = pop_pct, col = transport)) +
  geom_line() +
  scale_color_brewer(palette = 'Dark2') +
  scale_x_continuous(labels = scales::percent_format()) +
  scale_y_continuous(labels = scales::percent_format()) +
  theme_bw() +
  theme(axis.title = element_blank()) +
  guides(color = guide_legend(title = 'Mode')) +
  annotate(geom = 'text', x = 0.2, y = 0.6, label=indexText, hjust=0)
```


# Discussion

The empirical findings here follow the literature and traditional wisdom of American city development.
But it intersting what has not changed from 1917 - the center of the city, despite
a general decrease in population, remains the highest density area of the city. The densest areas of 
Milwaukee have a population density north of 3,000 people per square kilometer, or about 7,700 people 
per square mile. Transport improvements there affect a proportionately large of number people when 
compared to suburbs and new areas that emerged beyond the reach of streetcar lines.

When comparing any rail based intervention, it is worth considering the extents of possible implementation.
Streetcars and light rail are often terms that are used interchangeably; the differences are often 
in service more than form. Light rail may extend further into suburbs than streetcar and be grade
separated on some or all of its routes[@william_t_king_economic_2014]. 
Our new hypothetical Milwaukee network could be streetcars mingling
in traffic, or it could be completely grade separated underground light rail trains. These
options carry wildly different cost constraints and service level expectations, but as our system
is strictly imaginary, we should consider various levels of service to identify potential improvements
over current bus infrastructure.

Given this flexibility, is a valid strategy for reducing automobile dependency to 
re-create trolley lines as light rail and/or streetcar lines? The evidence is mixed. 
Spatially, the new light rail lines would not add any areas underserved by buses to the 
greater transit network, no matter what type of network is instituted. Several 
sources indicate the transit ridership is not dramatically improved through
creation of light rail[@william_t_king_economic_2014][@mallett_federal_nodate]. However, in complete 
opposition to these findings, another study estimated 670% increased ridership on a light
rail line over the previous bus line it replaced[@werner_evaluating_2016]. This large increase had 
several theorized origins - including the complementary nature of the route, as it fed directly into
a commuter rail system. And further, the final count of passengers could be rather small compared to 
the automobile traffic along the same corridor, but this was not directly measured or stated in the study.

Whether one agrees that the implementation of light rail would be a benefit or effectively 
"buses on rails," any transformational change to the city would have to come from the mode share itself. 
The cities of 1917 were denser than the cities of 2021. Kenneth Jackson put it best regarding the era of 
the walking city:

> On the European continent, ... [g]ross densities normally exceeded 75,000 per square mile and were rarely less than 35,000 per square mile, which is about the level of crowding of New York City in the 1980s. Although North American cities were newer and smaller than their European counterparts, they exhibited the same degree of intense, innercity congestion[@jackson_crabgrass_1985].

Cities of the streetcar era were not the same density levels as cities of the walking era, and thus we can 
expect that Milwaukee of 1917 was less dense than the figures quoted here. However, it was certainly 
more dense than the Milwaukee of the mid 20 century.

Transit is a tradeoff between massification and atomization, and the effect of a light rail 
system is to add a high-mass transportation mode between destinations or along a given route. Yet without
the underlying conditions that support mass transit, it is not abundantly clear where the new economic
benefits will come from. 

Milwaukee is one of the many cities experimenting with new streetcar/light rail routes. Its 
new system, "The Hop" is, a private public partnership that primarily serves a Milwaukee's 
downtown area and affluent neighborhoods of the Third Ward, but instead of being viewed as a transportation
project, it is seen seen as driver of economic development. In its current form, The Hop mostly accrues
benefits to just the downtown core and private entities therein[@diciaula_transit-oriented_2019]. 
The Hop's route coincides with some older routes, but does not go to nearly as many destinations and lacks
the interconnectivity with other transportation options to be fully utilized as a primary 
means of transportation.

TODO: add map showing Milwaukee census blocks with no population!

* What conclusions can we draw about the layout of cities and the requirements of new light rail projects?
* In what ways would historical routes provide higher or lower levels of service in modern context?

This method of transit development is valid, but it is tangential to the primary purpose of said transit -
to serve as a linkage between people, goods, and services. Economic development
and even aesthetics be benefits of transportation projects, but if the transportation mode does not 
actually serve any the derived demands along its routes, the mechanism by whch the stated benefits
accrue is unclear. In terms of people transported, the level of service is dependent on the 
spatial organization of people and activities more 
than what transit option is provided. That is to say, even if Milwaukee's trolleys had never been 
ripped up and replaced with buses, their routes would still be connecting areas of decreasing 
population in the downtown core.

In the case of Milwaukee especially, in order for trolley routes to provide service equal to the 
existing bus lines, they would not only need to be replaced in downtown Milwaukee, 
but expanded into suburban areas. If the simplest streetcar developments were put into place, we would
expect relatively low capacity vehicles mixing in traffic and there would be little difference
between buses and trolleys at that point. If, however, the city of Milwaukee were to drastically
upzone in the downtown area, suddenly light rail becomes a more attractive options, as higher
capcity vehicles with more reliable service could be used. Density could be increased to bring 
more people close to transportation options. 

It seems evident that transportation plans would need to be enacted simultaneously as part of a 
transit oriented development 


# Conclusion

The hollowing out of American cities will not be undone by a revolution in light rail.

# References
